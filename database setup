sqlite3 hubstuff.db

BEGIN;
CREATE TABLE IF NOT EXISTS Devices (
  devKey INTEGER,
  userName TEXT,
  modelName TEXT,
  manufName TEXT,
  nwkId TEXT,
  eui64 TEXT,
  devType TEXT,
  endPoints TEXT,
  inClusters TEXT,
  outClusters TEXT,
  binding TEXT,
  reporting TEXT,
  iasZoneType TEXT,
  firmwareVersion TEXT);

CREATE TABLE IF NOT EXISTS Status (
  devKey INTEGER,
  battery INTEGER, battery_time DATETIME,
  temperature INTEGER, temperature_time DATETIME,
  signal INTEGER, signal_time DATETIME,
  presence TEXT, presence_time DATETIME,
  powerReadingW INTEGER, powerReadingW_time DATETIME,
  energyForHourWh INTEGER, energyForHourWh_time DATETIME,
  FOREIGN KEY(devKey) REFERENCES Devices(devKey));

CREATE TABLE IF NOT EXISTS Events (
  timestamp DATETIME,
  event TEXT,
  devKey INTEGER,
  FOREIGN KEY(devKey) REFERENCES Devices(devKey));

CREATE TABLE IF NOT EXISTS Groups (
  userName TEXT,
  devKeyList TEXT);

CREATE TABLE IF NOT EXISTS Rules (rule TEXT);
# .import rules.txt Rules;

CREATE TABLE IF NOT EXISTS AppState (Name TEXT PRIMARY KEY, Value TEXT);

CREATE TABLE IF NOT EXISTS Users (
    id INTEGER PRIMARY KEY,
    name varchar(64),
    passwordHash varchar(255),
    email varchar(64));
    CREATE UNIQUE INDEX name_UNIQUE ON users (name ASC);
    CREATE UNIQUE INDEX email_UNIQUE ON users (email ASC);

COMMIT;
.quit
# Next line needed to allow Python to write back to the database
chmod 666 hubstuff.db
# Next line needed to allow SQL from Apache to write back to the database
chmod 777 ..

